{"version":3,"file":"Callback-B23NFS3-.js","sources":["../../src/pages/auth/Callback.tsx"],"sourcesContent":["import { useEffect } from 'react';\nimport { useNavigate, useSearchParams, useLocation } from 'react-router-dom';\nimport { supabase } from '@/integrations/supabase/client';\nimport { toast } from 'sonner';\n\nconst Callback = () => {\n  console.log('Callback component mounted');\n  \n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const location = useLocation();\n\n  useEffect(() => {\n    const handleCallback = async () => {\n      try {\n        // Get the current session\n        const { data: { session }, error: sessionError } = await supabase.auth.getSession();\n        \n        if (sessionError) {\n          console.error('Session error:', sessionError);\n          toast.error('Authentication failed');\n          navigate('/login');\n          return;\n        }\n\n        if (!session?.user) {\n          // No session found, redirect to login\n          toast.error('Authentication failed', {\n            description: 'Please try logging in again'\n          });\n          navigate('/login');\n          return;\n        }\n\n        // Check if profile exists\n        const { data: profile, error: profileError } = await supabase\n          .from('profiles')\n          .select('*')\n          .eq('id', session.user.id)\n          .single();\n        \n        if (profileError && profileError.code !== 'PGRST116') {\n          console.error('Profile fetch error:', profileError);\n          toast.error('Failed to fetch profile');\n          navigate('/login');\n          return;\n        }\n        \n        // If no profile exists, create one\n        if (!profile) {\n          const { error: createError } = await supabase\n            .from('profiles')\n            .insert([\n              {\n                id: session.user.id,\n                name: session.user.user_metadata.name || session.user.email?.split('@')[0] || 'User',\n                email: session.user.email,\n                join_date: new Date().toISOString(),\n                timezone: 'UTC'\n              }\n            ]);\n          \n          if (createError) {\n            console.error('Profile creation error:', createError);\n            toast.error('Profile setup failed', {\n              description: 'Please try updating your profile later'\n            });\n          } else {\n            toast.success('Profile created successfully');\n          }\n        }\n\n        // Redirect to home page instead of profile\n        toast.success('Authentication successful');\n        navigate('/');\n      } catch (error) {\n        console.error('Error in callback:', error);\n        toast.error('Authentication error');\n        navigate('/login');\n      }\n    };\n\n    // Add a small delay to ensure Supabase has time to process the authentication\n    const timer = setTimeout(() => {\n      handleCallback();\n    }, 1000);\n\n    return () => clearTimeout(timer);\n  }, [navigate]);\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen\">\n      <div className=\"flex flex-col items-center gap-4\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary\"></div>\n        <p className=\"text-lg\">Verifying your account...</p>\n        <p className=\"text-sm text-muted-foreground\">Please wait while we complete the process.</p>\n      </div>\n    </div>\n  );\n};\n\nexport default Callback;\n"],"names":["Callback","navigate","useNavigate","useSearchParams","useLocation","useEffect","handleCallback","session","sessionError","supabase","toast","profile","profileError","createError","_a","error","timer","jsxs","jsx"],"mappings":"mFAKA,MAAMA,EAAW,IAAM,CACrB,QAAQ,IAAI,4BAA4B,EAExC,MAAMC,EAAWC,EAAY,EACN,OAAAC,EAAgB,EACtBC,EAAY,EAE7BC,EAAAA,UAAU,IAAM,CACd,MAAMC,EAAiB,SAAY,OAC7B,GAAA,CAEI,KAAA,CAAE,KAAM,CAAE,QAAAC,GAAW,MAAOC,CAAA,EAAiB,MAAMC,EAAS,KAAK,WAAW,EAElF,GAAID,EAAc,CACR,QAAA,MAAM,iBAAkBA,CAAY,EAC5CE,EAAM,MAAM,uBAAuB,EACnCT,EAAS,QAAQ,EACjB,MAAA,CAGE,GAAA,EAACM,GAAA,MAAAA,EAAS,MAAM,CAElBG,EAAM,MAAM,wBAAyB,CACnC,YAAa,6BAAA,CACd,EACDT,EAAS,QAAQ,EACjB,MAAA,CAII,KAAA,CAAE,KAAMU,EAAS,MAAOC,GAAiB,MAAMH,EAClD,KAAK,UAAU,EACf,OAAO,GAAG,EACV,GAAG,KAAMF,EAAQ,KAAK,EAAE,EACxB,OAAO,EAEN,GAAAK,GAAgBA,EAAa,OAAS,WAAY,CAC5C,QAAA,MAAM,uBAAwBA,CAAY,EAClDF,EAAM,MAAM,yBAAyB,EACrCT,EAAS,QAAQ,EACjB,MAAA,CAIF,GAAI,CAACU,EAAS,CACN,KAAA,CAAE,MAAOE,GAAgB,MAAMJ,EAClC,KAAK,UAAU,EACf,OAAO,CACN,CACE,GAAIF,EAAQ,KAAK,GACjB,KAAMA,EAAQ,KAAK,cAAc,QAAQO,EAAAP,EAAQ,KAAK,QAAb,YAAAO,EAAoB,MAAM,KAAK,KAAM,OAC9E,MAAOP,EAAQ,KAAK,MACpB,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,SAAU,KAAA,CACZ,CACD,EAECM,GACM,QAAA,MAAM,0BAA2BA,CAAW,EACpDH,EAAM,MAAM,uBAAwB,CAClC,YAAa,wCAAA,CACd,GAEDA,EAAM,QAAQ,8BAA8B,CAC9C,CAIFA,EAAM,QAAQ,2BAA2B,EACzCT,EAAS,GAAG,QACLc,EAAO,CACN,QAAA,MAAM,qBAAsBA,CAAK,EACzCL,EAAM,MAAM,sBAAsB,EAClCT,EAAS,QAAQ,CAAA,CAErB,EAGMe,EAAQ,WAAW,IAAM,CACdV,EAAA,GACd,GAAI,EAEA,MAAA,IAAM,aAAaU,CAAK,CAAA,EAC9B,CAACf,CAAQ,CAAC,QAGV,MAAI,CAAA,UAAU,gDACb,SAACgB,EAAA,KAAA,MAAA,CAAI,UAAU,mCACb,SAAA,CAACC,EAAAA,IAAA,MAAA,CAAI,UAAU,0EAA2E,CAAA,EACzFA,EAAA,IAAA,IAAA,CAAE,UAAU,UAAU,SAAyB,4BAAA,EAC/CA,EAAA,IAAA,IAAA,CAAE,UAAU,gCAAgC,SAA0C,4CAAA,CAAA,CAAA,CAAA,CACzF,CACF,CAAA,CAEJ"}